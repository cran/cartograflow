<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Françoise Bahoken, Sylvain Blondeau" />

<meta name="date" content="2020-07-19" />

<title>Cartograflow</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Cartograflow</h1>
<h3 class="subtitle">Filtering Origin-Destination Matrix for Thematic Flow Mapping</h3>
<h4 class="author">Françoise Bahoken, Sylvain Blondeau</h4>
<h4 class="date">2020-07-19</h4>



<p><code>Cartograflow</code> is designed to filter origin-destination (OD) flow matrix for thematic mapping purposes.</p>
<div id="description-of-functions" class="section level2">
<h2>Description of functions</h2>
<p><strong>1. Preparing flow data sets:</strong> <br /></p>
<p><strong>1.1 General functions</strong><br /> You can use long “L” or matrix “M” [n*n] flow dataset formats.</p>
<p>– <code>flowtabmat()</code> is to transform “L” to “M” formats, also to build an empty square matrix from spatial codes.</p>
<p>– <code>flowcarre()</code> is to square a matrix.</p>
<p>– <code>flowjointure()</code> is to performs a spatial join between a flow dataset and a spatial features layer or an external matrix.</p>
<p>– <code>flowstructmat()</code> fixes an unpreviously codes shift in the flow dataset “M” format. If necessary this function is to be used with <code>flowjointure</code> and <code>flowtabmat</code>.</p>
<p><strong>1.2. Flow computation:</strong></p>
<p>– <code>flowtype()</code> is to compute several types of flow from an asymmetric matrix: <br /> x= <code>flux</code> for remaining initial flow (Fij) <br /> x= <code>transpose</code> for reverse flow value (Fji) <br /> x= <code>bivolum</code> for bilateral volum, as gross flow (FSij)<br /> x= <code>bibal</code> for bilateral balance, as net flow (FBij) <br /> x= <code>biasym</code> for asymetry of bilateral flow (FAij) <br /> x= <code>bimin</code> for minimum of bilateral flow (minFij) <br /> x= <code>bimax</code> for maximum of bilateral flow (maxFij) <br /> x= <code>birange</code> for bilateral flow range (rangeFij) <br /> x= <code>bidisym</code> for bilateral disymetry as (FDij) <br /></p>
<p>– <code>flowplaces()</code> is to compute several types of flow places oriented from an asymmetric:<br /> ie. as a dataframe that describes the flows from Origin / destination point of view <br /> x= <code>ini</code> for the number of incoming links (as in-degree) <br /> x= <code>outi</code> for the number of outcoming links (as out-degree) <br /> x= <code>degi</code> for the total number of links (as in and out degrees) <br /> x= <code>intra</code> for total intra zonal interaction (if main diagonal is not empty <br /> x= <code>Dj</code> for the total flows received by (j) place <br /> x= <code>voli</code> for the total volume of flow per place <br /> x= <code>bali</code> for the net balance of flow per place <br /> x= <code>asyi</code> for the asymetry of flow per place <br /> x= <code>allflowplaces</code> for computing all the above indicators <br /></p>
<p><strong>1.3. Flow reduction:</strong></p>
<p>– <code>flowlowup()</code> is to extracts the upper or the lower triangular part of a matrix - preferably for symmetrical matrixes.</p>
<p>x= <code>up</code> for the part above the main diagonal <br /> x= <code>low</code> for the part below the main diagonal <br /></p>
<p>– <code>flowreduct()</code> is to reduce the flow dataset regarding another matrix, e.g. distances travelled. <br /></p>
<p><code>metric</code> is the metric of the distance matrix :<br /> - metric= <code>continuous</code> (e.g. for kilometers) <br /> - metric= <code>ordinal</code> (e.g. for <code>k</code> contiguity) <br /></p>
<p>If the metric is <code>continuous</code> (e.g for filtering flows by kilometric distances travelled), use:<br /></p>
<p><code>d.criteria</code> is for selecting the minimum or the maximum distance criteria <br /> - d.criteria= <code>dmin</code> for keeping only flows up to a <em>dmin</em> criterion in km <br /> - d.criteria= <code>dmax</code> for selecting values less than a <em>dmax</em> criterion in km <br /></p>
<p><code>d</code> is the value of the selected <code>dmin</code> or <code>dmax</code> criteria.</p>
<p>Notice that these arguments can be used as a filter criterion in <code>flowmap()</code>.</p>
<p>See Cartograflow_distance and Cartograflow_ordinal_distance Vignettes for examples.<br /> URL: <a href="https://github.com/fbahoken/cartogRaflow/tree/master/vignettes" class="uri">https://github.com/fbahoken/cartogRaflow/tree/master/vignettes</a></p>
<p><strong>2. Flows filtering:</strong> <br /></p>
<p><strong>2.1. Filtering from flow concentration analysis</strong></p>
<p><strong>Flow concentration analysis:</strong></p>
<p>– <code>flowgini()</code> performs a Gini’s concentration analysis of the flow features, by computing <em>Gini coefficient</em> and plotting interactive <em>Lorenz curve</em>.</p>
<p>To be use before <code>flowanalysis()</code></p>
<p>See Cartograflow_concentration Vignette for example.<br /> URL: <a href="https://github.com/fbahoken/cartogRaflow/tree/master/vignettes" class="uri">https://github.com/fbahoken/cartogRaflow/tree/master/vignettes</a></p>
<p><strong>Flow filtering according to a concentration criterion:</strong></p>
<p>– <code>flowanalysis()</code> computes filters criterions based on:<br /></p>
<ul>
<li>argument <code>critflow</code> is to filter the flows according to their significativity (% of total of flow information) ; <br /></li>
<li>argument <code>critlink</code> is to filter the flows according to their density (% of total features) <br /></li>
</ul>
<p>These arguments can be used as <code>filter</code> criterion in <code>flowmap()</code>.</p>
<p>See Cartograflow_concentration Vignette for example.<br /> URL: <a href="https://github.com/fbahoken/cartogRaflow/tree/master/vignettes" class="uri">https://github.com/fbahoken/cartogRaflow/tree/master/vignettes</a></p>
<p><strong>2.2. Spatial / territorial filtering of flows</strong></p>
<p><strong>Flow filtering based on a continuous distance criterion</strong></p>
<p>– <code>flowdist()</code> computes a <em>continous distance</em> matrix from spatial features (area or points). The result is a matrix of the distances travelled between ODs, with flows filtered or not.</p>
<p>See Cartograflow_distance Vignette for example.<br /> URL: <a href="https://github.com/fbahoken/cartogRaflow/tree/master/vignettes" class="uri">https://github.com/fbahoken/cartogRaflow/tree/master/vignettes</a></p>
<p><strong>Flow filtering based on an ordinal distance / neighbourhood criterion</strong>:</p>
<p>– <code>flowcontig()</code> compute an <em>ordinal distance</em> matrix from spatial features (area). The result is a matrix of adjacency or k-contiguity of the ODs.</p>
<ul>
<li><code>background</code> is the areal spatial features ;<br /></li>
<li>code` is the spatial features codes ; <br /></li>
<li><code>k</code> is to enter the number (k:1,2,…,k) of the contiguity matrix to be constructed : if (k=1), ODs places are adjacent, then the flow have to cross only 1 boundary, else (k=k) ODs places are distant from n borders ;<br /></li>
<li><code>algo</code> is the algorithm to use for ordinal distance calculation (also Default is “automatic” for “Dijkstra’s”) ; <br /></li>
</ul>
<p>Notice that the function automatically returns the maximum (k) number of the spatial layer.</p>
<p>See Cartograflow_distance_ordinal Vignette for example.</p>
<p><strong>3. Flow mapping</strong></p>
<p>– <code>flowmap()</code> is to plot flows as segments or arrows, by acting on the following arguments:<br /></p>
<ul>
<li><code>filter</code> is to filter or not flow’s information or features <br /></li>
<li><code>threshold</code> is used to set the filtering level of the flows when filter=“True” <br /></li>
<li><code>taille</code> is the value of the width of the flow feature <br /></li>
<li><code>a.head</code> is the arrow head parameter (in, out, in and out) <br /></li>
<li><code>a.length</code> is the length of the edges of the arrow head (in inches) <br /></li>
<li><code>a.angle</code> is the angle from the shaft of the arrow to the edge of the arrow head <br /></li>
<li><code>a.col</code> is the arrow’s color <br /></li>
<li><code>plota</code> is to add spatial features as map background to the flows’s plot <br /></li>
<li><code>add</code> is to allow to overlay flow features on external spatial features background <br /></li>
</ul>
</div>
<div id="examples-of-applications" class="section level2">
<h2>Examples of applications</h2>
<p>– <strong>Useful packages</strong> Best external R package to use: {dplyr} {sf} {igraph} {rlang} {cartography}</p>
</div>
<div id="load-datasets" class="section level2">
<h2><strong>1. Load datasets</strong></h2>
<p><strong>Flow dataset</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Load Statistical information</span></a>
<a class="sourceLine" id="cb1-2" title="2">tabflow&lt;-<span class="kw">read.csv2</span>(<span class="st">&quot;./data/MOBPRO_ETP.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;;&quot;</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1-3" title="3">                   <span class="dt">encoding=</span><span class="st">&quot;UTF-8&quot;</span>, <span class="dt">dec=</span><span class="st">&quot;.&quot;</span>,<span class="dt">check.names=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    121 obs. of  4 variables:
##  $ i    : chr  &quot;T1&quot; &quot;T1&quot; &quot;T1&quot; &quot;T1&quot; ...
##  $ j    : chr  &quot;T1&quot; &quot;T10&quot; &quot;T11&quot; &quot;T12&quot; ...
##  $ Fij  : num  291058 8297 3889 17064 12163 ...
##  $ count: num  351 43 13 77 52 55 134 63 53 14 ...</code></pre>
<p><strong>Select variable and change matrix format</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Selecting useful variables for changing format</span></a>
<a class="sourceLine" id="cb3-2" title="2">tabflow&lt;-tabflow <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(i,j,Fij)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># From list (L) to matrix (M) format</span></a>
<a class="sourceLine" id="cb3-5" title="5">matflow &lt;-<span class="kw">flowtabmat</span>(tabflow,<span class="dt">matlist=</span><span class="st">&quot;M&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">head</span>(matflow[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a></code></pre></div>
<pre><code>##         T1   T10   T11   T12
## T1  291058  8297  3889 17064
## T10  73743 19501 11707  4931
## T11  22408  9359 12108  6084
## T12  68625  1906  7269 46515</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">dim</span>(matflow)</a></code></pre></div>
<pre><code>## [1] 12 12</code></pre>
<p><strong>Geographical dataset</strong></p>
</div>
<div id="flow-types-computing" class="section level2">
<h2><strong>2. Flow types computing</strong></h2>
<p><em>Compute bilateral flows types : eg. volum, balance, bilateral maximum and all types</em></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Bilateral volum (gross) FSij:  </span></a>
<a class="sourceLine" id="cb7-2" title="2">tabflow_vol&lt;-<span class="kw">flowtype</span>(tabflow, <span class="dt">format=</span><span class="st">&quot;L&quot;</span>, <span class="dt">origin=</span><span class="st">&quot;i&quot;</span>, <span class="dt">destination=</span><span class="st">&quot;j&quot;</span>, <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>,  <span class="dt">x=</span> <span class="st">&quot;bivolum&quot;</span> )</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"># Matrix format (M= : matflow_vol&lt;-flowtype(matflow, format=&quot;M&quot;, &quot;bivolum&quot;)</span></a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># Bilateral balance (net ) FBij:  </span></a>
<a class="sourceLine" id="cb7-6" title="6">tabflow_net&lt;-<span class="kw">flowtype</span>(tabflow, <span class="dt">format=</span><span class="st">&quot;L&quot;</span>, <span class="dt">origin=</span><span class="st">&quot;i&quot;</span>, <span class="dt">destination=</span><span class="st">&quot;j&quot;</span>, <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>, <span class="dt">x=</span><span class="st">&quot;bibal&quot;</span>)</a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># Bilateral maximum (maxFij): </span></a>
<a class="sourceLine" id="cb7-9" title="9">tabflow_max&lt;-<span class="kw">flowtype</span>(tabflow, <span class="dt">format=</span><span class="st">&quot;L&quot;</span>, <span class="dt">origin=</span><span class="st">&quot;i&quot;</span>, <span class="dt">destination=</span><span class="st">&quot;j&quot;</span>, <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>, <span class="dt">x=</span><span class="st">&quot;bimax&quot;</span>)</a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co"># Compute all types of bilateral flows, in one 11 columns</span></a>
<a class="sourceLine" id="cb7-12" title="12">tabflow_all&lt;-<span class="kw">flowtype</span>(tabflow,<span class="dt">format=</span><span class="st">&quot;L&quot;</span>, <span class="dt">origin=</span><span class="st">&quot;i&quot;</span>, <span class="dt">destination=</span><span class="st">&quot;j&quot;</span>, <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>, <span class="dt">x=</span><span class="st">&quot;alltypes&quot;</span>)</a>
<a class="sourceLine" id="cb7-13" title="13"><span class="kw">head</span>(tabflow_all) </a></code></pre></div>
<pre><code>##    i   j    Fij    Fji   FSij  FBij      FAij minFij maxFij rangeFij      FDij
## 1 T1  T1 291058 291058 582116     0 0.0000000 291058 291058        0 0.0000000
## 2 T1 T10   8297  73743  82040 65446 0.7977328   8297  73743    65446 0.7977328
## 3 T1 T11   3889  22408  26297 18519 0.7042248   3889  22408    18519 0.7042248
## 4 T1 T12  17064  68625  85689 51561 0.6017225  17064  68625    51561 0.6017225
## 5 T1  T2  12163  47427  59590 35264 0.5917771  12163  47427    35264 0.5917771
## 6 T1  T3  32682  45772  78454 13090 0.1668494  32682  45772    13090 0.1668494</code></pre>
</div>
<div id="direct-flow-mapping" class="section level2">
<h2><strong>3. Direct flow mapping</strong></h2>
<p><strong>3.1. Plot all origin-destination without any filtering criterion</strong> The result will reveal a graphic complexity (“spaghetti-effect”&quot;)</p>
<p>Plot links</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb9-2" title="2">map&lt;-<span class="kw">st_read</span>(<span class="st">&quot;./data/MGP_TER.shp&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `MGP_TER&#39; from data source `/tmp/RtmpmeYsUo/Rbuild751f7853470a/cartograflow/vignettes/data/MGP_TER.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 12 features and 14 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 637297.4 ymin: 6838629 xmax: 671752.1 ymax: 6879246
## projected CRS:  Lambert_Conformal_Conic</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Add and overlay spatial background </span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">par</span>(<span class="dt">bg =</span> <span class="st">&quot;NA&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co"># Graphic parameters</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb11-6" title="6">extent &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2800000</span>, <span class="dv">1340000</span>, <span class="dv">6400000</span>, <span class="dv">4800000</span>)</a>
<a class="sourceLine" id="cb11-7" title="7">resolution&lt;-<span class="dv">150</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border=</span><span class="ot">NA</span>, <span class="dt">bg=</span><span class="st">&quot;#dfe6e1&quot;</span>)</a>
<a class="sourceLine" id="cb11-10" title="10"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="st">&quot;light grey&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co"># Flowmapping of all links</span></a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="kw">flowmap</span>(<span class="dt">tab=</span>tabflow,</a>
<a class="sourceLine" id="cb11-15" title="15">        <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>,</a>
<a class="sourceLine" id="cb11-16" title="16">        <span class="dt">origin.f =</span> <span class="st">&quot;i&quot;</span>,</a>
<a class="sourceLine" id="cb11-17" title="17">        <span class="dt">destination.f =</span> <span class="st">&quot;j&quot;</span>,</a>
<a class="sourceLine" id="cb11-18" title="18">        <span class="dt">bkg =</span> map,</a>
<a class="sourceLine" id="cb11-19" title="19">        <span class="dt">code=</span><span class="st">&quot;EPT_NUM&quot;</span>,</a>
<a class="sourceLine" id="cb11-20" title="20">        <span class="dt">nodes.X=</span><span class="st">&quot;X&quot;</span>,</a>
<a class="sourceLine" id="cb11-21" title="21">        <span class="dt">nodes.Y =</span> <span class="st">&quot;Y&quot;</span>,</a>
<a class="sourceLine" id="cb11-22" title="22">        <span class="dt">filter=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb11-23" title="23">        <span class="dt">add=</span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb11-24" title="24">        )</a>
<a class="sourceLine" id="cb11-25" title="25"></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="kw">library</span>(cartography)</a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="co"># Map cosmetics</span></a>
<a class="sourceLine" id="cb11-29" title="29"><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;All origin-destination for commuting in Greater Paris, 2017&quot;</span>,</a>
<a class="sourceLine" id="cb11-30" title="30">           <span class="dt">coltitle =</span><span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb11-31" title="31">           <span class="dt">author =</span> <span class="st">&quot;Cartograflow, 2020&quot;</span>,</a>
<a class="sourceLine" id="cb11-32" title="32">           <span class="dt">sources =</span> <span class="st">&quot;Data : INSEE, 2017 ; Basemap : APUR, RIATE, 2018.&quot;</span>,</a>
<a class="sourceLine" id="cb11-33" title="33">           <span class="dt">scale =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb11-34" title="34">           <span class="dt">tabtitle =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb11-35" title="35">           <span class="dt">frame =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb11-36" title="36">           <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span></a>
<a class="sourceLine" id="cb11-37" title="37">            )</a>
<a class="sourceLine" id="cb11-38" title="38"><span class="co"># North arrow</span></a>
<a class="sourceLine" id="cb11-39" title="39"><span class="kw">north</span>(<span class="st">&quot;topright&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p><strong>3.2. Plot the above-average flows</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb12-2" title="2">map&lt;-<span class="kw">st_read</span>(<span class="st">&quot;./data/MGP_TER.shp&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `MGP_TER&#39; from data source `/tmp/RtmpmeYsUo/Rbuild751f7853470a/cartograflow/vignettes/data/MGP_TER.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 12 features and 14 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 637297.4 ymin: 6838629 xmax: 671752.1 ymax: 6879246
## projected CRS:  Lambert_Conformal_Conic</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Add and overlay spatial background </span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">par</span>(<span class="dt">bg =</span> <span class="st">&quot;NA&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" title="3"></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co"># Graphic parameters</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb14-6" title="6">extent &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2800000</span>, <span class="dv">1340000</span>, <span class="dv">6400000</span>, <span class="dv">4800000</span>)</a>
<a class="sourceLine" id="cb14-7" title="7">resolution&lt;-<span class="dv">150</span></a>
<a class="sourceLine" id="cb14-8" title="8"></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border=</span><span class="ot">NA</span>, <span class="dt">bg=</span><span class="st">&quot;#dfe6e1&quot;</span>)</a>
<a class="sourceLine" id="cb14-10" title="10"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="st">&quot;light grey&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-11" title="11"></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co"># Flow mapping above-average flows</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="kw">flowmap</span>(<span class="dt">tab=</span>tabflow,</a>
<a class="sourceLine" id="cb14-14" title="14">        <span class="dt">fij=</span><span class="st">&quot;Fij&quot;</span>,</a>
<a class="sourceLine" id="cb14-15" title="15">        <span class="dt">origin.f =</span> <span class="st">&quot;i&quot;</span>,</a>
<a class="sourceLine" id="cb14-16" title="16">        <span class="dt">destination.f =</span> <span class="st">&quot;j&quot;</span>,</a>
<a class="sourceLine" id="cb14-17" title="17">        <span class="dt">bkg =</span> map,</a>
<a class="sourceLine" id="cb14-18" title="18">        <span class="dt">code=</span><span class="st">&quot;EPT_NUM&quot;</span>,</a>
<a class="sourceLine" id="cb14-19" title="19">        <span class="dt">nodes.X=</span><span class="st">&quot;X&quot;</span>,</a>
<a class="sourceLine" id="cb14-20" title="20">        <span class="dt">nodes.Y =</span> <span class="st">&quot;Y&quot;</span>,</a>
<a class="sourceLine" id="cb14-21" title="21">        <span class="dt">filter=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb14-22" title="22">        <span class="dt">threshold =</span>(<span class="kw">mean</span>(tabflow<span class="op">$</span>Fij)),  <span class="co">#mean value is the level of threshold</span></a>
<a class="sourceLine" id="cb14-23" title="23">        <span class="dt">taille=</span><span class="dv">20</span>,           </a>
<a class="sourceLine" id="cb14-24" title="24">        <span class="dt">a.head =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb14-25" title="25">        <span class="dt">a.length =</span> <span class="fl">0.11</span>,</a>
<a class="sourceLine" id="cb14-26" title="26">        <span class="dt">a.angle =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb14-27" title="27">        <span class="dt">a.col=</span><span class="st">&quot;#138913&quot;</span>,</a>
<a class="sourceLine" id="cb14-28" title="28">        <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-29" title="29"></a>
<a class="sourceLine" id="cb14-30" title="30"><span class="co"># Map Legend</span></a>
<a class="sourceLine" id="cb14-31" title="31"><span class="kw">legendPropLines</span>(<span class="dt">pos=</span><span class="st">&quot;topleft&quot;</span>,</a>
<a class="sourceLine" id="cb14-32" title="32">                <span class="dt">title.txt=</span><span class="st">&quot;Commuters &gt; 13220 &quot;</span>,</a>
<a class="sourceLine" id="cb14-33" title="33">                <span class="dt">title.cex=</span><span class="fl">0.8</span>,   </a>
<a class="sourceLine" id="cb14-34" title="34">                <span class="dt">cex=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb14-35" title="35">                <span class="dt">values.cex=</span> <span class="fl">0.7</span>,  </a>
<a class="sourceLine" id="cb14-36" title="36">                <span class="dt">var=</span><span class="kw">c</span>(<span class="kw">mean</span>(tabflow<span class="op">$</span>Fij),<span class="kw">max</span>(tabflow<span class="op">$</span>Fij)), </a>
<a class="sourceLine" id="cb14-37" title="37">                <span class="dt">lwd=</span><span class="dv">5</span>, </a>
<a class="sourceLine" id="cb14-38" title="38">                <span class="dt">frame =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb14-39" title="39">                <span class="dt">col=</span><span class="st">&quot;#138913&quot;</span>,</a>
<a class="sourceLine" id="cb14-40" title="40">                <span class="dt">values.rnd =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb14-41" title="41">                )</a>
<a class="sourceLine" id="cb14-42" title="42"></a>
<a class="sourceLine" id="cb14-43" title="43"><span class="co">#Map cosmetic</span></a>
<a class="sourceLine" id="cb14-44" title="44"></a>
<a class="sourceLine" id="cb14-45" title="45"><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Commuters up to above-average in Greater Paris&quot;</span>,</a>
<a class="sourceLine" id="cb14-46" title="46">           <span class="dt">coltitle =</span><span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb14-47" title="47">           <span class="dt">author =</span> <span class="st">&quot;Cartograflow, 2020&quot;</span>,</a>
<a class="sourceLine" id="cb14-48" title="48">           <span class="dt">sources =</span> <span class="st">&quot;Data : INSEE, 2017 ; Basemap : APUR, RIATE, 2018.&quot;</span>,</a>
<a class="sourceLine" id="cb14-49" title="49">           <span class="dt">scale =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb14-50" title="50">           <span class="dt">tabtitle =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb14-51" title="51">           <span class="dt">frame =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb14-52" title="52">           <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span></a>
<a class="sourceLine" id="cb14-53" title="53">            )</a>
<a class="sourceLine" id="cb14-54" title="54"></a>
<a class="sourceLine" id="cb14-55" title="55"><span class="co"># North arrow</span></a>
<a class="sourceLine" id="cb14-56" title="56"><span class="kw">north</span>(<span class="st">&quot;topright&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAJACAMAAABSRCkEAAAAElBMVEX+/v4AAAATiRMzMzO+vr7f5uG3oDxCAAAABnRSTlP///////+evUsyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAZH0lEQVR4nO2dibakKgxFn179/19+XQ7ILJCgCZ69VncNQqDMLsSp7n8LAAT+e7sDQDcQCJA4BZr+8XzrjzfZ+DGnd1aPBg6BJvNfmtY1mKnXNylh9OzHvOtnZDmkcgS6QZ1Ale01CAR8gY6h+t9/18Ox9s5RfH/cXi/eNuEsuThvOvXcd70ox79YSXeZX+/oqLudOaoFHYxVn/x+RuoFrS+xD/Y1XIHMilqm6+F60y2yWMuc6ibhduzIl9iUjMe0Jh7hMrvP0/We08LxHfA7uMQ6n/h8Z3lLEnuZ8+Sb1As0nV/D46UVzIxAi71KowLtUbwKZsjwR7Bg2eRHmRa/Xiy9e6ngo0yxNxcvktcX60N9156ldQRa7JUYjPQFI5BrjvVt9lOXWOaNFl6LVqFos+5Hufl8yZLW+x9WyN0LSwpkjQGmiFVvuaJM/hzIq+eW9JbZcy63pLdscqI4n8FvOBbM6Xzu81n1gurRFj6HdxzIm7Eu5gt+LHSLXK+uKMsUrM3IdNuU9JZNqZjesslZNiVamHxvTQX/Qyc/37LYAcLqk9/s1+hxJPrp1fnxMeBdRhDo42PAu+BcGCABgQAJCARIQCBAAgIBEhAIkPhvWQFoBwIBEhAIkIBAgAQEAiQgECBhBPqdkKSH80NMR+Rf7KOFsyGO5sAL/DmvToEm81+akoy7ZS5JprOFs6GpLB4QR0agG4oSPjnPp+tdV6ASYYFE/v4cg3yBzHZmvR7OnJttz7ZBWt0tkmGKvJiC1xBIK3mBrg3MdD1YWx2nSEKEKXhuHLseIJBW6AKdc+KjRmzeHL6YrqL7wBUUBSr4+3MNahyBVtuNuDJeIW9zBoGUkhVoSgt0jjmpDdqJ54Q12HjTIeyF6SQlkHeU5vh3Ppg5tVfkenVGcRpzDgAdm75zC4jjQCr5+/MMwpFoUAMEAiQgEKDw9+cbBIFABRAIkIBAgMLfX2AQBALlQCBAAgIBCn9/oUEQCBRTLpB39ak5D79aJ+NZLoEFmigWyL9qcAqvQ8XZ9O/x9xcx6BRoPvm9iJyaj55Uh0CfolygjckdfC6BrsvJIBBICnRevhEIdF3iAX9ASiD7fpzVEeh4EyMQ2IgL5F8iBoHAxp/57yS9F2Y/9ffCINBHKRXoOtZjXq5mQp24Hwx8gG3f614gAOL8/eyBQKCVv8OhCwgEKti2YBAItFI4iQYgTrlA1g6Xf0egf48z+A7FAgU/gOCcQ7X+Bx8ncT2Qf+zZPQdv3SQPPk5uE+aejV9X+4D0ik0Y+JE6G3/OgYLt2PW7ChAI3Ah0PvEvIoNA4KReILMzBoHAzW78GvpjPYNAIHdXhnU2/njzWnwVAR8HR6IBCQgESEAgQAICARIQCJCAQIBE/jjQNDkvzf67fTwRfJrc5RzWedPrwb1FHnydoss57L/yBYGATe5cmHc74XQdjDa/sQC+ToFAljzXVMj+cxngw9xdUBYRyPvhBfBpSgRyL6oPbpwHXyZ/V0bkmnr/4jLwbbKXc8SOA+FHNoENjkQDEhAIkIBAgAQEAiQgECBxc1eG8+D8xB0AP7Jn492H66wYDgCBk9zZePfBfQeAjfJNGAQCEW5ubQ4FwhwI2GAEAiQgECBRsRuPvTAQcvfjCtYDjgOBEByJBiQgECABgQAJCARIQCBAAgIBEhAIkIBAgAQEAiQgECABgQAJCARIQCBAAgIBEhAIkIBAgAQEAiQgECABgQAJCARIQCBAAgIJZPnxdicKgUDy2OTRYhAEEsehjhKDIJA4fhmZj0f5QCBpmB9J0ZEZCCSIebZ/ZUdHZiCQHA53ll0gzIFAG/sIpMQfCCSNYxTS4g8EEsa29TI/NKgACCSKffoMgUAb+vyBQJI4fiQXAoEmzh9ZhkCghcsfCATq0eWNAQLJYFbqDwSSgVZ9IJAM9PoDgSSg2B8IJADN/kCg91HtDwR6Hd3+QKC3Ue4PBPJ4+JYstYd/DFoF6pToh2/JUq+PWoE6JfrhW7IG8EepQL0SvRxJfWaljOCPVoE6JfpRgYbwR61Ax7XnXeI+I9AY/mgVyPsr98xxn5gDDeKPToGsOzh5szD3GdjiLfVv5AkUCjR78Efmi5hpqHsjz6BOoPm4c6qDQp2GtWhDnVt4Dm0Cnf6cP2LBmO8rXuf0juSPOoE2rkzPfOmwhzaWgJmGusZ/FqUCXRIxBt1v6ust0Fj+qBTozDRvMq6AXVM8mD8aBZodgdj34/vmeDR/dAq0/280Yo3dV6Dh/FEokPFnXvmHoL4JHujwj0GdQGcOZkck7uhdGFAflQL5r5kPRfNFC4N3i/0e2gQKstBhV74PY/qjTaBIFpQINKg/+gSKvceWmn5ZHtUfZQJF08B7OpUp0lOBX0ebQPF3pQs0rj+6BEqkgW0I6pTnEQ//GDQJlMwDV4b6JHpkfbQJlF4iV6Cx/dEkUCYRTENQj1wP7o8igbKZECvQ6P6oEii7kCNR/Nke3h89At1kgsMg+NOAFoFuUyFRoA/4o0ig2wLkbPFfWzS+P1oEKkiFNIE+oY8WgYqSQc4Y96VFfMEEo0WgokK0nMGfFlQIVJgMQQJ9xh8VApVmgzgEqbiuSBw6BCouKEOgD/mjQaCKbJAyx5b2L/mjQKCadJA2Ynyn9D/kjwqBqgo3J0/yJSGCES9QXT4IX3+xJ/RlI12g2oS0GyT0fL505AtUXeFFgb7nj3SB6jPSPARJPJ2vANkCtWSkMYvyzubrQLpALXWa8gh/2hAtULMKbd41tEVtVT+SBXp0NiPoTKwqZAvUWu+5qRNLbc0IFujZY4IyTqPpQ7RAhKqPHT4iV1aOXIGIGa2sLeAsrE7ECvTwnOT9s7BKESwQrXb9ObT2phprDoFUgRjusKg9jf9IO8MhVKDHjwu3nwBpqTYQYgWiR6iJAX9akSnQ45fmvHX+TD8iBeK6tqvz1fjwZxUrEE+U8jjPn/wYBYkCvXB7TYMM8GdDoECc92cVRoI/zYgUiC9SL4E+f/jHIE8g3p846POzDNDHIE4g7h9ZKYr20GHrEREoEG+0DgLBHwtpAjHnpnAI6nHQcflRHlUrwgRi/3IXBWT151i6yfMBg8QJxB/xPiTnMevZ4gsGyRKow+SiZCPGeMRxnj2DSgNrRZRAXWannAIV2Dj7lEVWizCBugQtSXppqLL27BFocJkkCdRpDd9mjvtokSWMNwciuyRPQUECdfuGFgjEEcaUSvqTLFeOuFFMlEDdAudDF5tR1pSh+DhQsUvz8U/QMSY5AnWcInAIVFKIYfqcrb+/+zNzFXOEQIJA+5rqODjfZLPQjZJWjsTzzJhDl5yXMgwSI1DXjXs+n2VyFDRxJpfHn2h0uxkBqZMjUMcN2HoTvkyO+xKXNvwChW2tEMiwC9S3iUxGS+y4j25J088fjEBR5gf2TgkC3SyPTHp7+BPZgglInRSBzNShYyPJ4PeC5Jf6+rDjtCHMHwkC7QNQ7zSkg98akg/atd9+A8dzHAe6WJZ5mbsnYs2YcKdIblm/TkfXyTz3HaYbeFugxT3b2HlDkHg/WykXr0+Xc6tDmj9vC7Qsjj5v7MrfjDHpJT16fLcqxPnzukBPXu0QbyEvSXoJd48fWw28vC3Q7NOxsXj4nCXJMLx9VerOxtsCRQ7S91uPVQKlt3icndTszsbbAoVDUMc1Gota5w9j754Zdbvz/l5Y2iD+VRsJmR5o4tU5ujWIOxtvC7TOeYOYV3KpQLF3Wfozkjsb7wsUu1ahm0RhqNRQE6tJ68lo6uy8LdBxkea1ZjtbVCRQdJyidGFMdzaECLQ6q7ejREGIuCzhO62ND+zOxssCzdd//jruZJFXPepPUKGpVd6hUypiBLrZ7+GT6EagpMaVbXzAnY23N2E/Sq/347HIrRYZb6JNV4X/iDsbCgTay/BZlBPIX1bVwMfU2dEi0FaOSSK7eDDihK3Vda2mIyOgSaC9MN0iq6hby3pRHvO77myoE2irQJTIESjxdkG0xgFwLCQI1PabEwSLriLemOMFLmq8pe8DoVegrWKjREeBOTIW3QaAOw66Bdpr11t0LLSKHE/yNaFOyAAC7SEqJPKXz9aNaSk/4E6CUQTawhRalCiQUgTu5BhJoD3WrUXxRTFLEgICi+EE2uLlJbp3DO4UM6RAe9AG/Io9+jUY4wq0Ba7UB+pUM7ZAe/SWYQgUIkKg/j9/DHd68RGB9lbgDj9fEmhvCv6w8jmBYBAvEAgKkficQJgI8fI5ge52yB7syRB8TaAbfeBQLd8S6DQECrHxIYFsOyLOwKEmZAj0gEGuF74rc+w0ffc+jcBHBAqU8D2Zw1PxcKiETwgU2nC89gYlpzQUKuIDAsVMcKZC7nsrhqEaRhcoLoG95XKuQgzqwaEbxhYolX53c+UUDyrDoSwjC5TM/JwQyP+tBUyH7hlXoEzWvdlOfJETBQ6lGFSgbMK9eU/eIDiUZ0iBbnIdTJaDyqmAcChAiECcBt1lOZg3R4acZFQo5DGcQPcZnoNdrWyJIDQcshlMoILkzqFApQZhUxYykkBleQ0nzYkf8Mg3Aod2xhGoMKOxOXOsUiYUFLIYRaDibJYKlDMIDl2MIVB5IoNS6Zq3U3E4tI4hUEUOI+UydQum4593SL1AdemLFMzVLpmRf1wh5QJVZi5WNhugbFb+ZYekCNRkUHXSYoXzIUrif3pTplig+nzFi99EKWriuw6pFaglVfHyd3Eq5ucfVEinQG1pStS4jVQzRf+cQxoFak1Qos59sPLWvrcp0ydQc25StUriVTT4MYe0CURIS7JaScSqNr/kkCqBSBlJVyyKWdnsZxRSJBAxG+maZVFrm/7IMKRGIGoeMnVLA1c3/wWHxAiUN4ieglztbgZ9wCEVAjGs/Wz14uhNncgoNIBS8gVi+fLmA5THb+tIahgaYVCSLhDT0J8PUdNEY2eiDo2wWRMmkLdCuWYON0GqWmnuT+gQBGJivv4LRniWFXwXpaodQpd8hQYwSIRAmzzmK3m+x7d2b+NUtsSmEONnfAt5Au1vsK7a20C1bZF6FjFoEZGFJmQI9LNnvvxh/mLex6puj9i7YAjSa5AQgf7pYwRiH9cLglW3SO7hKAaJEWhZ9jXJPy0oCdfQJrmTnkG0YK8hRaDF+al41tAl8VpaZd2MQSAa/0bwTvqUbWya2iV1NZgFtYd6FSkCdZj6HJTFbDWI65DQLCMP9YgTiFujwmCNrbZ39fqsv8H3NwNsDPQyEMgUa2qVZtD25J88y3kgTB9SBNq6ce6KMQpUGqu5VY7Ozud5HHKk5xEi0G4Q/zherEW7t3Tfr+FHoUFSBPpn0LLtivFGLU8uYeCjGqR3+7UKEuiA16AKKShbTqJBEIgT7oPQFUVJ++StVVf7ahaFiBOIc1XWOEGcu1MqQyBmOE/DVxV+ySC1E+gfEgXi/NXxutKkDRHDVFohIgViWpl1KSUffyILSGn8NWQKxPbD9ZXF6RdoUGrTGn8JoQJxfB8r08lxCJw2i6K1/RJSBaIbVK0DxzmU7xkkViCyQdW5ZDkJRzqaRG38DeQKRDSoPpFMZ3E/ZpBggWgrtFGgVw2CQNwQju42ZJHrQhLCWVmG1h9GtkDNBjWpwHYlUnMcCMTOk1dYMF7K1nptEU/rTyJdoLZhvc0EzmshP2OQeIGaDCJcXPiuQRCoA8/dbsN6OXbjKMjV/FMoEKjeoOY5LOv1/G17gnzNP4MGgWoNat8J4hWoxSB1e/IqBKr8YlKujn/fIMbmn0CJQLV/zKe1FWaBWs7IsTbfHy0CVaxY2sXx791YdFbgbb83agQqXrHEuyt63NtYV565/c7oEah0fkm6P6KDQNVG6zJIkUBlBpGvjH/tF2ZMafb2e6JJoCKDJApUe38Rfwf6oUqggnXLcGdFj/zVGdShA93QJdCtQdT89xKo7ibZHh3ohTKB7tYuNf3shxKd0MVFu3SgD+oEyq5devb7CVTzUzN9OtAFfQLd/GU6avB+Ao1pkEKB0quXIfk9Bar4vbRePeBHo0DJqTRD7jtOgo7wRcW6dYAdlQIlDGJJfV+BxjNIp0Bxg1gy31mgwk5CoN44adiTwpP53gIVKqTGIK0COavYCMQRtrtARR2FQP2ZzeOWEa7Ew6AqFAt0ruNLIJ6o/QUqkR0CPcBp0C8dbFl/QqAC3SHQE+xr+RJIwX681cxNgf594EC3QKvZ/eKbBnU+lGi3k1/evwscKBdoPb0xcIR8RKBb3XUYpF2gn0ELpz7PCXQ3CEGgZ5jnhdWfBwXKG6Tj0lbNAu2r3/yROq71/aBANwY91AkSmgVaz2Qzz3sfNih9dcpDfSChXKD19+dW94TzfZAnBcoOQhoMGkGgPQdaBcoYBIGeYP97vecDBw8LpNsg/QIdf6+X8XM8dSjRaTC+4MFONDKAQMff62XkaYGSg5CCPfkRBGLneYGSBj3biwYgUIQXBEoYBIFU8vgk6Gw18ubTvagFAsV4RaCoQRBIJe8IpNIgCBTjJYFi+/MQSCNvCRQZhKTvyUOgKJIMeqUbxUCgKO8JFBgEgTTyokDBREi2QRAoypsC+YMQBFLIO4cS7ebtV6/1owAIFOddgVyDIJBCXhbImQiJ3pOHQHHeFsgZhCCQPt4XyDLo7Z7kgEAJJBn0ek8yQKAEAgS6zHm/J0kgUAIRAp0GCehJCgiUQIZA8g2CQAlePpTo9AMCaUSIQPsgJKQrESBQCjECHQYx37rEBQRKIUKg6zf8Zt6bJ9mAQCkkTILmoxOCDYJASQQI5Px638r5AxJsQKAkEgTagUAqkSOQEUdgsiBQEkkCsf+EDRsQKI00gyT6A4EyCBKI/ydsuIBAaSQJJBYIlGY+z0PBojQQKI17DAZEgUAJzAFgCJQFAsWZXd7ujlwgUBwIVAgEigN/CoFACSBQGRAoBQQqAgIlgT8lQKA0EKgACJTGCIR1lAYCZTgHIKyjNBAowwKBboFAGfj/GOJ4QKAMy2aQzAu5pACBcsi9EFAMECiL2AsBxQCBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEACAgESEAiQgECABAQCJCAQIAGBAAkIBEhAIEDiEGj6UVVxr7HVmfZXx3vT+RCpsD8er9c1UdJugM5kGlrP7ib7NzmP17vln2hl6rUazhFoOv5dr24xVSbnIVHbqGZW9F1jU2ZZOXaT3kO8g05Xc92IfqJo6JGpEmgKXh0rzTUnt7qvtT6tkdKT97wtFZP31DenQKDIq2gr/icaTSBnQI19Lk+ga1MU1N5eOrHXY60VCXQs8b7nvj92C06Xgof1ejWt6X52FCj6iQYTyP04BQIdT/2vcDTAmeBAvOQ0YPITE41pnl9hgtRPtrXT5Nf0nk41c6CoQOWfaKw5ULVA9ope4yvaCX6MBsfr/Ag0hYnJflm9Lpn0TJdA7kw+3uhVxBqPIqXdjeo1bc6MQJFPNNgItOEIZI3/G65A1xfcVLwXyBoKvAYj3agWyP5uX8WnS4PICOS3GgoUKW59b4J+ln+iAQWa7GfBVzAU6MzT9SoS6qpiSkYEik3AsnpG5kC28f4mzCyLzM7spxGBTifdDk7us1Cg20/kf0HU42TEbOMDgayDIOcIbr3y6ls1TEKjx4GC8teb7rYy0Vu7E94k2jS7TkGqUpNoU/0SI1Qt2CyerZZ+omsHZB0A/4uZHIHqo7EXb/7SBtVK43Tt4Hj+mCG2WSChDJEqmVz7Etur4z97qz6CQOBFzCS6dZttNvkFBa2SU3E9IJpzEm3+sylIrrvncVPwGP4m/xUQy5RmL2ALFNYuaKC0rLsf7u2VA6Fk/IkLdO7m+nuk1/70edDF2p++Irg72ZH+OMpAoAGIjEDXNPs6PmYdfbPsmKypk70tSwlkH4LxXwGdREagyRLE/D8F8nhHAl2BYmeb3DNH37x6ZjxcgewhZPUEMvtbsZIFAsXqQSD1uHth59DgbJbsCe9qp/52BArOKZyLvVdAL95xoPPE02redZa5mzB7rPJOBJ1z6qsh98xR9OQSUEj5kej6zQ3c+AAVpzKaD1aDgcG5MEACAgESEAiQgECABAQCJP4H3rSudOBvUsYAAAAASUVORK5CYII=" /><!-- --></p>
<p><strong>3.3. Plot the net flows of bilateral flows</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co">#library(sf)</span></a>
<a class="sourceLine" id="cb15-2" title="2">map&lt;-<span class="kw">st_read</span>(<span class="st">&quot;./data/MGP_TER.shp&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `MGP_TER&#39; from data source `/tmp/RtmpmeYsUo/Rbuild751f7853470a/cartograflow/vignettes/data/MGP_TER.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 12 features and 14 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 637297.4 ymin: 6838629 xmax: 671752.1 ymax: 6879246
## projected CRS:  Lambert_Conformal_Conic</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># Net matrix reduction</span></a>
<a class="sourceLine" id="cb17-2" title="2">tabflow_net &lt;-<span class="st"> </span>tabflow_net <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(.data<span class="op">$</span>FBij<span class="op">&gt;=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="co"># Net matrix thresholding</span></a>
<a class="sourceLine" id="cb17-5" title="5">Q80&lt;-<span class="kw">quantile</span>(tabflow_net<span class="op">$</span>FBij,<span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co"># Add and overlay spatial background </span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="kw">par</span>(<span class="dt">bg =</span> <span class="st">&quot;NA&quot;</span>)</a>
<a class="sourceLine" id="cb17-10" title="10"></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co"># Graphic parameters</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb17-13" title="13">extent &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2800000</span>, <span class="dv">1340000</span>, <span class="dv">6400000</span>, <span class="dv">4800000</span>)</a>
<a class="sourceLine" id="cb17-14" title="14">resolution&lt;-<span class="dv">150</span></a>
<a class="sourceLine" id="cb17-15" title="15"></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border=</span><span class="ot">NA</span>, <span class="dt">bg=</span><span class="st">&quot;#dfe6e1&quot;</span>)</a>
<a class="sourceLine" id="cb17-17" title="17"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(map), <span class="dt">col =</span> <span class="st">&quot;light grey&quot;</span>, <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-18" title="18"></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="co"># Flow mapping above-average flows</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="kw">flowmap</span>(<span class="dt">tab=</span>tabflow_net,</a>
<a class="sourceLine" id="cb17-21" title="21">        <span class="dt">fij=</span><span class="st">&quot;FBij&quot;</span>,</a>
<a class="sourceLine" id="cb17-22" title="22">        <span class="dt">origin.f =</span> <span class="st">&quot;i&quot;</span>,</a>
<a class="sourceLine" id="cb17-23" title="23">        <span class="dt">destination.f =</span> <span class="st">&quot;j&quot;</span>,</a>
<a class="sourceLine" id="cb17-24" title="24">        <span class="dt">bkg =</span> map,</a>
<a class="sourceLine" id="cb17-25" title="25">        <span class="dt">code=</span><span class="st">&quot;EPT_NUM&quot;</span>,</a>
<a class="sourceLine" id="cb17-26" title="26">        <span class="dt">nodes.X=</span><span class="st">&quot;X&quot;</span>,</a>
<a class="sourceLine" id="cb17-27" title="27">        <span class="dt">nodes.Y =</span> <span class="st">&quot;Y&quot;</span>,</a>
<a class="sourceLine" id="cb17-28" title="28">        <span class="dt">filter=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb17-29" title="29">        <span class="dt">threshold =</span> Q80,</a>
<a class="sourceLine" id="cb17-30" title="30">        <span class="dt">taille=</span><span class="dv">12</span>,           </a>
<a class="sourceLine" id="cb17-31" title="31">        <span class="dt">a.head =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb17-32" title="32">        <span class="dt">a.length =</span> <span class="fl">0.11</span>,</a>
<a class="sourceLine" id="cb17-33" title="33">        <span class="dt">a.angle =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb17-34" title="34">        <span class="dt">a.col=</span><span class="st">&quot;#4e8ef5&quot;</span>,</a>
<a class="sourceLine" id="cb17-35" title="35">        <span class="dt">add=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-36" title="36"></a>
<a class="sourceLine" id="cb17-37" title="37"><span class="co"># Map Legend</span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="kw">legendPropLines</span>(<span class="dt">pos=</span><span class="st">&quot;topleft&quot;</span>,</a>
<a class="sourceLine" id="cb17-39" title="39">                <span class="dt">title.txt=</span><span class="st">&quot;Commuters &gt; 5722 &quot;</span>,</a>
<a class="sourceLine" id="cb17-40" title="40">                <span class="dt">title.cex=</span><span class="fl">0.8</span>,   </a>
<a class="sourceLine" id="cb17-41" title="41">                <span class="dt">cex=</span><span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb17-42" title="42">                <span class="dt">values.cex=</span> <span class="fl">0.7</span>,  </a>
<a class="sourceLine" id="cb17-43" title="43">                <span class="dt">var=</span><span class="kw">c</span>(Q80,<span class="kw">max</span>(tabflow_net<span class="op">$</span>FBij)), </a>
<a class="sourceLine" id="cb17-44" title="44">                <span class="dt">lwd=</span><span class="dv">12</span>, </a>
<a class="sourceLine" id="cb17-45" title="45">                <span class="dt">frame =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb17-46" title="46">                <span class="dt">col=</span><span class="st">&quot;#4e8ef5&quot;</span>,</a>
<a class="sourceLine" id="cb17-47" title="47">                <span class="dt">values.rnd =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb17-48" title="48">                )</a>
<a class="sourceLine" id="cb17-49" title="49"></a>
<a class="sourceLine" id="cb17-50" title="50"><span class="co">#Map cosmetic</span></a>
<a class="sourceLine" id="cb17-51" title="51"></a>
<a class="sourceLine" id="cb17-52" title="52"><span class="kw">layoutLayer</span>(<span class="dt">title =</span> <span class="st">&quot;Net commuters in Greater Paris (20% strongest)&quot;</span>,</a>
<a class="sourceLine" id="cb17-53" title="53">           <span class="dt">coltitle =</span><span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb17-54" title="54">           <span class="dt">author =</span> <span class="st">&quot;Cartograflow, 2020&quot;</span>,</a>
<a class="sourceLine" id="cb17-55" title="55">           <span class="dt">sources =</span> <span class="st">&quot;Data : INSEE, 2017 ; Basemap : APUR, RIATE, 2018.&quot;</span>,</a>
<a class="sourceLine" id="cb17-56" title="56">           <span class="dt">scale =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb17-57" title="57">           <span class="dt">tabtitle =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb17-58" title="58">           <span class="dt">frame =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb17-59" title="59">           <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span></a>
<a class="sourceLine" id="cb17-60" title="60">            )</a>
<a class="sourceLine" id="cb17-61" title="61"></a>
<a class="sourceLine" id="cb17-62" title="62"><span class="co"># North arrow</span></a>
<a class="sourceLine" id="cb17-63" title="63"><span class="kw">north</span>(<span class="st">&quot;topright&quot;</span>)</a></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="sample-datasets" class="section level2">
<h2>Sample datasets</h2>
<p>– <em>Statistical dataset</em> : - INSEE - Base flux de mobilité (2015) - URL : <a href="https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip" class="uri">https://www.insee.fr/fr/statistiques/fichier/3566008/rp2015_mobpro_txt.zip</a></p>
<p>– <em>Geographical dataset</em> :</p>
<ul>
<li>municipalities : IGN, GEOFLA 2015 v2.1</li>
<li>Greater Paris : APUR, UMS 2414 RIATE, 2018.</li>
</ul>
</div>
<div id="see-also" class="section level2">
<h2>See also</h2>
<p><a href="https://github.com/fbahoken/cartogRaflow/tree/master/vignettes" class="uri">https://github.com/fbahoken/cartogRaflow/tree/master/vignettes</a></p>
<p>– cartograflow_general.html <br /> – cartograflow_concentration.html <br /> – cartograflow_distance.html <br /> – cartograflow_ordinal_distance.hmtl <br /></p>
</div>
<div id="reference" class="section level2">
<h2>Reference</h2>
<p>– Bahoken Francoise (2016), Programmes pour R/Rtudio annexés, in : <em>Contribution à la cartographie d’une matrix de flux</em>, Thèse de doctorat, Université Paris 7, pp. 325-346. URL : <a href="https://halshs.archives-ouvertes.fr/tel-01273776" class="uri">https://halshs.archives-ouvertes.fr/tel-01273776</a>, pp. 480-520.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
